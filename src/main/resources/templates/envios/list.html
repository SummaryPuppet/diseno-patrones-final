<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{layout :: head('Lista de Envíos')}"></head>
  <body>
    <div th:replace="~{layout :: header}"></div>

    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="m-0">Lista de Envíos</h1>
        <a class="btn btn-primary" th:href="@{/envios/nuevo}">Crear envío</a>
      </div>

      <div th:if="${message}" class="mb-3">
        <div class="alert alert-success" th:text="${message}"></div>
      </div>
      <div th:if="${error}" class="mb-3">
        <div class="alert alert-danger" th:text="${error}"></div>
      </div>

      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Ruta</th>
            <th>Tipo</th>
            <th>Origen</th>
            <th>Destino</th>
            <th>Estado</th>
            <th>Fecha</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="envio : ${envios}">
            <td th:text="${envio.id}">1</td>
            <td th:text="${envio.rutaId}">-</td>
            <td th:text="${envio.envioTipo}">DOCUMENTO</td>
            <td th:text="${envio.origen}">Lima</td>
            <td th:text="${envio.destino}">Cusco</td>
            <td th:text="${envio.status}">CREADO</td>
            <td th:text="${envio.fecha}">2025-01-01T12:00</td>
            <td>
              <a
                th:href="@{'/envios/' + ${envio.id}}"
                class="btn btn-sm btn-primary"
                >Ver</a
              >
              <a
                th:href="@{'/trazabilidad/envio/' + ${envio.id}}"
                class="btn btn-sm btn-outline-info ms-1"
                >Trazabilidad</a
              >

              <form
                th:action="@{'/envios/' + ${envio.id} + '/avance'}"
                method="post"
                style="display: inline"
              >
                <button
                  th:disabled="${envio.status == 'ENTREGADO'}"
                  th:classappend="${envio.status == 'ENTREGADO'} ? ' btn-secondary' : ' btn-success'"
                  class="btn btn-sm ms-1"
                  type="submit"
                >
                  <span
                    th:text="${envio.status == 'ENTREGADO'} ? 'Entregado' : 'Avanzar'"
                  ></span>
                </button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>

      <div th:if="${page != null and page.totalPages > 1}" class="mt-3">
        <nav aria-label="Page navigation">
          <ul class="pagination">
            <li class="page-item" th:classappend="${page.first} ? ' disabled'">
              <a
                class="page-link"
                th:href="@{/envios(page=${page.number-1},size=${pageSize})}"
                >Anterior</a
              >
            </li>

            <li
              class="page-item"
              th:each="i : ${#numbers.sequence(0, page.totalPages-1)}"
              th:classappend="${i == page.number} ? ' active'"
            >
              <a
                class="page-link"
                th:href="@{/envios(page=${i},size=${pageSize})}"
                th:text="${i + 1}"
              ></a>
            </li>

            <li class="page-item" th:classappend="${page.last} ? ' disabled'">
              <a
                class="page-link"
                th:href="@{/envios(page=${page.number+1},size=${pageSize})}"
                >Siguiente</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <div th:replace="~{layout :: footer}"></div>
  </body>
</html>
